This is adapted from getreuer's implementation, moved to a community module for validation purposes.
